<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>介绍 | urnotlynley的笔记</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/webBlog/logo.png">
    <meta name="description" content="urnotlynley的笔记">
    
    <link rel="preload" href="/webBlog/assets/css/0.styles.54b79104.css" as="style"><link rel="preload" href="/webBlog/assets/js/app.32dc9ccc.js" as="script"><link rel="preload" href="/webBlog/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/webBlog/assets/js/8.9a6adf03.js" as="script"><link rel="prefetch" href="/webBlog/assets/js/10.c0da759f.js"><link rel="prefetch" href="/webBlog/assets/js/11.84335070.js"><link rel="prefetch" href="/webBlog/assets/js/12.feaed3b6.js"><link rel="prefetch" href="/webBlog/assets/js/13.0ab32a28.js"><link rel="prefetch" href="/webBlog/assets/js/14.f6cda76d.js"><link rel="prefetch" href="/webBlog/assets/js/15.66d3e3eb.js"><link rel="prefetch" href="/webBlog/assets/js/3.df158bf2.js"><link rel="prefetch" href="/webBlog/assets/js/4.d12742be.js"><link rel="prefetch" href="/webBlog/assets/js/5.216cae74.js"><link rel="prefetch" href="/webBlog/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/webBlog/assets/js/7.9c9172a7.js"><link rel="prefetch" href="/webBlog/assets/js/9.d5989d31.js">
    <link rel="stylesheet" href="/webBlog/assets/css/0.styles.54b79104.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/webBlog/" class="home-link router-link-active"><!----> <span class="site-name">urnotlynley的笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/webBlog/" class="nav-link">
  Home
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/webBlog/" class="nav-link">
  Home
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>slidev</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/webBlog/blog/slidev/" class="sidebar-link">layout布局</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>正则匹配</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Electron</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/webBlog/blog/Electron/" aria-current="page" class="active sidebar-link">介绍</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nuxt</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>V3使用记录</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h4 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h4> <p>main.js一般是主进程, 有且只有一个</p> <p>renderer.js是多个渲染进程</p> <p>运行命令是</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>electron <span class="token punctuation">.</span>
</code></pre></div><h4 id="快速搭建工具"><a href="#快速搭建工具" class="header-anchor">#</a> 快速搭建工具</h4> <p><a href="https://www.npmjs.com/package/electron-quick-start" target="_blank" rel="noopener noreferrer">electron-quick-start<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="创建第一个hello-world"><a href="#创建第一个hello-world" class="header-anchor">#</a> 创建第一个hello world</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> app<span class="token punctuation">,</span> BrowerWindow <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>'electron<span class="token punctuation">)</span>
<span class="token keyword">var</span> mainWindow <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token punctuation">;</span>  <span class="token comment">//声明要打开的主窗口</span>
app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    mainWindow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span>
     	<span class="token punctuation">{</span>
            <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">800</span><span class="token punctuation">,</span>
            <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">600</span><span class="token punctuation">,</span>
            <span class="token literal-property property">webPreferences</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token literal-property property">nodeIntegration</span><span class="token operator">:</span> <span class="token boolean">true</span> 
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>   <span class="token comment">//设置打开的窗口大小</span>
    mainWindow<span class="token punctuation">.</span><span class="token function">loadFile</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>  <span class="token comment">//加载那个页面</span>
    <span class="token comment">//监听关闭事件，把主窗口设置为null</span>
    mainWindow<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'closed'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        mainWindow <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>**nodeIntegration ** 是否集成node</p> <p><strong>可选项:</strong></p> <p><img src="https://upload-images.jianshu.io/upload_images/3399573-a58e91e9d077057c.png?imageMogr2/auto-orient/strip%7CimageView2/2/format/webp" alt="img"></p> <h4 id="开发插件"><a href="#开发插件" class="header-anchor">#</a> 开发插件</h4> <h5 id="nodemon"><a href="#nodemon" class="header-anchor">#</a> nodemon</h5> <p>在开发阶段可以安装nodemon, 监听改变main.js后自动更新</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;electron .&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon --watch main.js --exec \&quot;npm run dev\&quot;&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="组件间的数据通讯"><a href="#组件间的数据通讯" class="header-anchor">#</a> 组件间的数据通讯</h4> <p>renderer.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> ipcRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token string">'hello form renderer'</span><span class="token punctuation">)</span>
    ipcRenderer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'reply'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在renderer发送事件, 在main.js中监听对应事件</p> <p>使用ipcRenderer发送事件, 使用ipcMain监听</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> app<span class="token punctuation">,</span> BrowerWindow<span class="token punctuation">,</span> ipcMain <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    mainWindow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">width</span><span class="token operator">:</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token literal-property property">height</span><span class="token operator">:</span><span class="token number">400</span><span class="token punctuation">}</span><span class="token punctuation">)</span>   <span class="token comment">//设置打开的窗口大小</span>
    mainWindow<span class="token punctuation">.</span><span class="token function">loadFile</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>  <span class="token comment">//加载那个页面</span>
    <span class="token comment">//监听关闭事件，把主窗口设置为null</span>
    mainWindow<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'closed'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        mainWindow <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
        event<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'reply'</span> <span class="token punctuation">,</span> <span class="token string">'hello from main.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>event.sender可以找到发送事件的发送者</p> <h4 id="打开新窗口"><a href="#打开新窗口" class="header-anchor">#</a> 打开新窗口</h4> <p>打开新窗口的话需要使用 <strong>Electron Remote</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token keyword">const</span> BrowserWindow <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>remote<span class="token punctuation">.</span>BrowserWindow
</code></pre></div><p>然后其他的操作或者配置跟BrowserWindow一样</p> <h5 id="在electron14以后系统移除了remote-要使用的话需要自己安装"><a href="#在electron14以后系统移除了remote-要使用的话需要自己安装" class="header-anchor">#</a> 在electron14以后系统移除了remote, 要使用的话需要自己安装</h5> <p>1、首先在自己项目中npm安装 @electron/remote模块</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm install <span class="token operator">--</span>save @electron<span class="token operator">/</span>remote
</code></pre></div><p>2、在主进程初始化@electron/remote模块，然后在渲染中使用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@electron/remote/main'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>在主进程中这样引入</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> remote <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@electron/remote/main'</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>在渲染程序中这样引入</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> remote <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@electron/remote&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p><u><em>渲染程序中使用menu   是const Menu = remote.Menu</em></u></p> <p>3、在主进程main.js中，设置remote模块，在webPreferences中添加enableRemoteModule:true 和 contextIsolation为false。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">webPreferences</span><span class="token operator">:</span><span class="token punctuation">{</span> 
    <span class="token literal-property property">nodeIntegration</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">enableRemoteModule</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">contextIsolation</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre></div><p>4、渲染进程中，require('electron').remote替换为require('@electron/remote')</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> BrowserWindow <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@electron/remote'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BrowserWindow
</code></pre></div><p>要使用remote的话</p> <h4 id="编写菜单模版"><a href="#编写菜单模版" class="header-anchor">#</a> 编写菜单模版</h4> <p>新建一个menu.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Menu <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> template <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">label</span><span class="token operator">:</span><span class="token string">'凤来怡洗浴会所'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">submenu</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token literal-property property">label</span><span class="token operator">:</span><span class="token string">'精品SPA'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token literal-property property">label</span><span class="token operator">:</span><span class="token string">'泰式按摩'</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">label</span><span class="token operator">:</span><span class="token string">'大浪淘沙洗浴中心'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">submenu</span><span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token literal-property property">label</span><span class="token operator">:</span><span class="token string">'牛奶玫瑰浴'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token literal-property property">label</span><span class="token operator">:</span><span class="token string">'爱情拍拍手'</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> Menu<span class="token punctuation">.</span><span class="token function">buildFromTemplate</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>
Menu<span class="token punctuation">.</span><span class="token function">setApplicationMenu</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
</code></pre></div><p>然后在主进程中引用</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./main/menu.js'</span><span class="token punctuation">)</span>
</code></pre></div><p><strong><code>Menu</code>  属于是主线程下的模块，所以只能在主线程中使用</strong></p> <p>可以在菜单模版中增加 <code>click</code> 事件, 例如上面写的打开新窗口</p> <h4 id="绑定菜单快捷键"><a href="#绑定菜单快捷键" class="header-anchor">#</a> 绑定菜单快捷键</h4> <p>绑定快捷键的属性是 <code>accelerator</code> 属性，比如我们新打开一个窗口</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">accelerator</span><span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ctrl+n</span><span class="token template-punctuation string">`</span></span>
</code></pre></div><p>在lebel的同级, 写上accelerator表示绑定快捷键</p> <h4 id="创建右键菜单"><a href="#创建右键菜单" class="header-anchor">#</a> 创建右键菜单</h4> <p>在渲染程序中</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> rigthTemplate <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'粘贴'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'复制'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> Menu<span class="token punctuation">.</span><span class="token function">buildFromTemplate</span><span class="token punctuation">(</span>rigthTemplate<span class="token punctuation">)</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'contextmenu'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//阻止当前窗口默认事件</span>
  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">//把菜单模板添加到右键菜单</span>
  m<span class="token punctuation">.</span><span class="token function">popup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">window</span><span class="token operator">:</span> remote<span class="token punctuation">.</span><span class="token function">getCurrentWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="开启调试模式"><a href="#开启调试模式" class="header-anchor">#</a> 开启调试模式</h4> <p>在主进程main.js中</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>mainWindow<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">openDevTools</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="在浏览器中打开网页"><a href="#在浏览器中打开网页" class="header-anchor">#</a> 在浏览器中打开网页</h4> <p>通过shell在浏览器中打开网页  shell.openExternal</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> shell <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> aHref <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#aHref'</span><span class="token punctuation">)</span>
</code></pre></div><p>在onlad中绑定点击事件,  通过getAttribute获取dom绑定的属性值</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>aHref<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> href <span class="token operator">=</span> aHref<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span>
    shell<span class="token punctuation">.</span><span class="token function">openExternal</span><span class="token punctuation">(</span>href<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="在主进程中使用browserview嵌入网页"><a href="#在主进程中使用browserview嵌入网页" class="header-anchor">#</a> 在主进程中使用BrowserView嵌入网页</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> view <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
mainWindow<span class="token punctuation">.</span><span class="token function">setBrowserView</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span>
view<span class="token punctuation">.</span><span class="token function">setBounds</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">400</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
view<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span><span class="token string">'https://electronjs.org/'</span><span class="token punctuation">)</span>
</code></pre></div><p>(使用baidu网址或者其他网址可能无法显示, 是链接的问题)</p> <h4 id="打开子窗口"><a href="#打开子窗口" class="header-anchor">#</a> 打开子窗口</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'https://jspang.com'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="窗口组件通信"><a href="#窗口组件通信" class="header-anchor">#</a> 窗口组件通信</h4> <p>子窗口发送信息</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>opener<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span>targetOrigin<span class="token punctuation">)</span>
</code></pre></div><ul><li>message : 传递的消息，是<code>String</code>类型的值</li> <li>targetOrigin : 指定发送的窗口, 如果未指定来源则发送给<code>*</code>，即所有窗口。</li></ul> <p>父窗口接受信息</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> mytext <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#mytext'</span><span class="token punctuation">)</span>
    mytext<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="选择文件对话框"><a href="#选择文件对话框" class="header-anchor">#</a> 选择文件对话框</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> dialog <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>   <span class="token comment">//main主进程引入</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> dialog <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@electron/remote'</span><span class="token punctuation">)</span>  <span class="token comment">//渲染进程引入</span>
</code></pre></div><p>对话框API  dialog.showOpenDialog() 打开对话框</p> <ul><li>title ： String (可选)，对话框的标题</li> <li>defaultPath ： String (可选),默认打开的路径</li> <li>buttonLabel ： String (可选), 确认按钮的自定义标签，当为空时，将使用默认标签</li> <li>filters ： 文件选择过滤器，定义后可以对文件扩展名进行筛选</li> <li>properties：打开文件的属性，比如打开文件还是打开文件夹，甚至是隐藏文件。</li></ul> <p>的风格</p> <h4 id="保存文件"><a href="#保存文件" class="header-anchor">#</a> 保存文件</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>dialog<span class="token punctuation">.</span><span class="token function">showSaveDialog</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'保存文件'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>可以配合fs 保存一个文件到指定位置</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>filePath<span class="token punctuation">,</span><span class="token string">'技术胖一个前端爱好者'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="消息对话框"><a href="#消息对话框" class="header-anchor">#</a> 消息对话框</h4> <p>showMessageBox, 属性很多</p> <ul><li>type ：String类型，可以选，图标样式，有<code>none</code>、<code>info</code>、<code>error</code>、<code>question</code>和<code>warning</code></li> <li>title: String类型，弹出框的标题</li> <li>messsage : String 类型，必选 message box 的内容，这个是必须要写的</li> <li>buttons: 数组类型，返回的是一个索引数值（下标）</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>dialog<span class="token punctuation">.</span><span class="token function">showMessageBox</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'question'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'去不去由你'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'是不是要跟胖哥去大保健?'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">buttons</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'我要去'</span><span class="token punctuation">,</span> <span class="token string">'不去了'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="断网提醒功能"><a href="#断网提醒功能" class="header-anchor">#</a> 断网提醒功能</h4> <p>其实这个是JavaScript的一种方式进行监听网络状态,监听的事件分别是<code>online</code>和<code>offline</code>。</p> <div class="language- extra-class"><pre class="language-text"><code>window.addEventListener('online',function(){
	alert('来网了哦！')
})

window.addEventListener('offline',function(){
	alert('断网了哦，请稍等！')
})
</code></pre></div><h4 id="桌面通知-notification"><a href="#桌面通知-notification" class="header-anchor">#</a> 桌面通知 Notification</h4> <p>Notification.permission 该属性用于表明当前通知显示的授权状态，可能的值包括：</p> <ul><li>default ：不知道用户的选择，默认。</li> <li>granted ：用户允许。</li> <li>denied ：用户拒绝。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> options<span class="token punctuation">)</span>  <span class="token comment">//或者</span>
<span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>Notification</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>title<span class="token punctuation">,</span> option<span class="token punctuation">)</span>
</code></pre></div><p>option参数:</p> <ul><li>title：通知的标题</li> <li>options：通知的设置选项（可选）。</li> <li>body：通知的内容。</li> <li>tag：代表通知的一个识别标签，相同tag时只会打开同一个通知窗口。</li> <li>icon：要在通知中显示的图标的URL。</li> <li>image：要在通知中显示的图像的URL。</li> <li>data：想要和通知关联的任务类型的数据。</li> <li>requireInteraction：通知保持有效不自动关闭，默认为false。</li></ul> <h4 id="注册快捷键"><a href="#注册快捷键" class="header-anchor">#</a> 注册快捷键</h4> <p><code>globalShortcut</code> 是主进程中的模块，而且注册的都是全局的快捷键，所以尽量写在<code>main.js</code>中。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span>  globalShortcut <span class="token operator">=</span> electron<span class="token punctuation">.</span>globalShortcut
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>globalShortcut<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'ctrl+e'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    mainWindow<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span><span class="token string">'https://jspang.com'</span><span class="token punctuation">)</span>  
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>注册全局的快捷键必须在<code>ready</code>事件之后，才能注册成功。</strong></p> <h5 id="检测快捷键"><a href="#检测快捷键" class="header-anchor">#</a> 检测快捷键</h5> <p>是否注册成功可以使用<code>globalShortcut.isRegistered()</code>方法，来检测快捷键是否注册成功.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token keyword">let</span> isRegister<span class="token operator">=</span> globalShortcut<span class="token punctuation">.</span><span class="token function">isRegistered</span><span class="token punctuation">(</span><span class="token string">'ctrl+e'</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token string">'Register Success'</span><span class="token operator">:</span><span class="token string">'Register fail'</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'-------&gt;'</span><span class="token operator">+</span>isRegister<span class="token punctuation">)</span>
</code></pre></div><h5 id="注销快捷键"><a href="#注销快捷键" class="header-anchor">#</a> 注销快捷键</h5> <p>因为我们注册的是全局的快捷键，所以当我们关闭软件或者窗口时，记得一定要注销快捷键。防止关闭后打开其他软件和快捷键冲突。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'will-quit'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//注销全局快捷键的监听</span>
    globalShortcut<span class="token punctuation">.</span><span class="token function">unregister</span><span class="token punctuation">(</span><span class="token string">'ctrl+e'</span><span class="token punctuation">)</span>
    globalShortcut<span class="token punctuation">.</span><span class="token function">unregisterAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="复制功能"><a href="#复制功能" class="header-anchor">#</a> 复制功能</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code> <span class="token keyword">const</span> <span class="token punctuation">{</span> clipboard <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
 <span class="token keyword">const</span> code <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'code'</span><span class="token punctuation">)</span>
 <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span>
 btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 	clipboard<span class="token punctuation">.</span><span class="token function">writeText</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
 	<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'复制成功'</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
</code></pre></div><h4 id="本地存储使用electron-store"><a href="#本地存储使用electron-store" class="header-anchor">#</a> 本地存储使用electron-store</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> Store <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron-store'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">v4</span><span class="token operator">:</span> uuidv4 <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'uuid'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">DataStore</span> <span class="token keyword">extends</span> <span class="token class-name">Store</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">settings</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>settings<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tracks <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'tracks'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token function">saveTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'tracks'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tracks<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
  <span class="token punctuation">}</span>
  <span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'tracks'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token function">addTracks</span><span class="token punctuation">(</span><span class="token parameter">tracks</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tracksProps <span class="token operator">=</span> tracks
      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token function">uuidv4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token literal-property property">path</span><span class="token operator">:</span> x<span class="token punctuation">,</span>
          <span class="token literal-property property">fileName</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> currentTracks <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token operator">=&gt;</span> i<span class="token punctuation">.</span>path<span class="token punctuation">)</span>
        <span class="token keyword">return</span> currentTracks<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tracks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>tracks<span class="token punctuation">,</span> <span class="token operator">...</span>tracksProps<span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> DataStore
</code></pre></div><h4 id="webcontents中有一个-did-finish-load-事件-导航完成时触发"><a href="#webcontents中有一个-did-finish-load-事件-导航完成时触发" class="header-anchor">#</a> webContents中有一个 did-finish-load 事件, 导航完成时触发</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>mainWindow<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'did-finish-load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>原生使用js时候</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> <span class="token punctuation">{</span> dataset<span class="token punctuation">,</span> classList <span class="token punctuation">}</span> <span class="token operator">=</span> event<span class="token punctuation">.</span>target
</code></pre></div><p>使用dataset获取自定义在dom上的数据, 绑定自定义的数据是data-xx='' (<strong>xx</strong>是自定义的参数名)</p> <h4 id="audio标签"><a href="#audio标签" class="header-anchor">#</a> <strong>Audio</strong>标签</h4> <p><strong>Loadedmetadata</strong> 事件是媒体加载完毕以后的事件</p> <p><strong>Timeupdate</strong> 是播放时间更新会触发的事件</p> <h4 id="electron打包"><a href="#electron打包" class="header-anchor">#</a> <strong>Electron</strong>打包</h4> <ul><li>Electron packager</li> <li>Electron builder</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/webBlog/blog/RegExp/" class="prev">
        元字符
      </a></span> <span class="next"><a href="/webBlog/blog/Nuxt/">
        安装
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/webBlog/assets/js/app.32dc9ccc.js" defer></script><script src="/webBlog/assets/js/2.733019b2.js" defer></script><script src="/webBlog/assets/js/8.9a6adf03.js" defer></script>
  </body>
</html>
