<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>react学习 | urnotlynley的笔记</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/webBlog/logo.png">
    <meta name="description" content="urnotlynley的笔记">
    
    <link rel="preload" href="/webBlog/assets/css/0.styles.54b79104.css" as="style"><link rel="preload" href="/webBlog/assets/js/app.e7dfd760.js" as="script"><link rel="preload" href="/webBlog/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/webBlog/assets/js/12.feaed3b6.js" as="script"><link rel="prefetch" href="/webBlog/assets/js/10.c0da759f.js"><link rel="prefetch" href="/webBlog/assets/js/11.78b5a361.js"><link rel="prefetch" href="/webBlog/assets/js/13.ef5015ce.js"><link rel="prefetch" href="/webBlog/assets/js/14.1b2fb22e.js"><link rel="prefetch" href="/webBlog/assets/js/15.66d3e3eb.js"><link rel="prefetch" href="/webBlog/assets/js/3.df158bf2.js"><link rel="prefetch" href="/webBlog/assets/js/4.d12742be.js"><link rel="prefetch" href="/webBlog/assets/js/5.216cae74.js"><link rel="prefetch" href="/webBlog/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/webBlog/assets/js/7.9c9172a7.js"><link rel="prefetch" href="/webBlog/assets/js/8.b8974c76.js"><link rel="prefetch" href="/webBlog/assets/js/9.4837a5ea.js">
    <link rel="stylesheet" href="/webBlog/assets/css/0.styles.54b79104.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/webBlog/" class="home-link router-link-active"><!----> <span class="site-name">urnotlynley的笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/webBlog/" class="nav-link">
  Home
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/webBlog/" class="nav-link">
  Home
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>slidev</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/webBlog/blog/slidev/" class="sidebar-link">layout布局</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>正则匹配</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Electron</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nuxt</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>react</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/webBlog/blog/react/" aria-current="page" class="active sidebar-link">react学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webBlog/blog/react/#redux" class="sidebar-link">redux:</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>V3使用记录</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react学习"><a href="#react学习" class="header-anchor">#</a> react学习</h1> <ol><li><p>使用create-react-app创建项目</p></li> <li><p>render里的第一个数据是jsx, 相当于React.reacteElement
组件首字母必须大写(小写无法识别成组件), 组件可以传递字符串/数组/对象/事件 (都是单向数据流,子组件不建议修改数据)</p> <p><strong>使用jsx语法需要引入React，不引无法使用</strong></p></li> <li><p>只能返回一个根节点, 可以使用React.Fragment占位符  或者 return一个数组</p></li> <li><p><u>使用registerServiceWorker可以在部署到线上以后让用户没网访问时展示上一次访问内容</u></p></li></ol> <p>安装命令前端加sudo  是以管理员的身份安装插件</p> <h3 id="class类语法"><a href="#class类语法" class="header-anchor">#</a> class类语法:</h3> <ol><li><p>使用变量要是用  <strong>{}</strong>
class testClass extends React.Component里面使用 <strong>constructor(props)</strong> 接受传进来的参数   使用**super(props)**是固定语法，<strong>props</strong>也是固定的</p></li> <li><p>不能直接修改state里的数据(就是vue中的data)  要使用 <strong>setState</strong> 修改数据</p></li> <li><p>setState可能是异步的,  对于多个setState执⾏行行，会合并成一个调⽤用，因此对同一个状态执⾏多次只起一次作⽤(最后一次)
this.setState((state, props) =&gt; ({ counter: state.counter + 1}))  传入函数可以拿到最新的值, setState官方建议<strong>设置为函数形式而不用对象形式</strong></p> <p>setState中的键名使用[]中括号包起来表示一个变量, 否则表示一个字符串的key</p></li> <li><p>class中的生命周期函数:</p> <ul><li><p>componentDidMount组件挂载时</p></li> <li><p>componentWillUnmount组件卸载时</p></li></ul></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>dangerouslySetInnerHTML<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">__html</span><span class="token operator">:</span>item<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre></div><p>设置标签上的html可以被识别转义(类似于v-html)
label标签的for=&quot;其他的id&quot;便签要改成htmlFor  (label标签点击后可以让指定输入框获取焦点)</p> <h3 id="prop类型"><a href="#prop类型" class="header-anchor">#</a> <strong>prop类型</strong></h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">&quot;prop-types&quot;</span>
</code></pre></div><p>使用 <strong>PropTypes</strong> 限制组件传值的类型
子组件名称.propTypes = {变量名:PropTypes.string.[isRequired]}
子组件名称.deafultProps 设置默认值
PropTypes .arrayOf(PropTypes .string,PropTypes.number)  使用或语法</p> <p>*** 建议不要使用index作为key值，这样diff算法会匹配不上，相当于全部都重新渲染了，影响性能**</p> <p>*** 请求最好放在componentDidMount中**
*** 避免子组件频繁更新应该在shouldComponentUpdate中做判断返回false**</p> <h3 id="css模块化"><a href="#css模块化" class="header-anchor">#</a> css模块化</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createGlobalStyle<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'styled-components'</span>
</code></pre></div><p>需要引入，在render中插入</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>Fragment<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>createGlobalStyle <span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Fragment<span class="token operator">&gt;</span>
</code></pre></div><p>*** 可以使用reset.css重置所有浏览的基本样式，自行在官网搜索**</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> styled <span class="token keyword">from</span> <span class="token string">&quot;styled-components&quot;</span>
</code></pre></div><p>styled.a标签设置跳转地址可以 <strong>设置attrs({href:'/'})</strong>  或者 <strong>在引用的地方直接写href</strong></p> <p>render函数里面绑定的style要用双括号  <strong>{{}}</strong>  因为里面的括号代表一个对象   变量使用单括号 <strong>{}</strong></p> <h3 id="css动画"><a href="#css动画" class="header-anchor">#</a> CSS动画</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> CSSTransition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-transition-group&quot;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>CSSTransition <span class="token keyword">in</span><span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>focused<span class="token punctuation">}</span> timeout<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">200</span><span class="token punctuation">}</span> classNames<span class="token operator">=</span><span class="token string">&quot;slide&quot;</span><span class="token operator">&gt;</span>
    <span class="token comment">//包裹需要使用动画的组件</span>
    <span class="token operator">&lt;</span>NavSearch
    className<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>focused <span class="token operator">?</span> <span class="token string">&quot;focused&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
    onFocus<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>handleInputFocus<span class="token punctuation">}</span>
    onBlur<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>handleInputBlur<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>NavSearch<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>CSSTransition<span class="token operator">&gt;</span>
</code></pre></div><ol><li><p>in设置动画开关</p></li> <li><p>timeout=设置动画时长</p></li> <li><p>classNames取动画名称</p></li> <li><p>在css中使用.slide-enter和.slide-exit设置具体的动画形式</p></li> <li><p>设置unmountOnExit 意思是元素退场时，自动把DOM也删除</p></li> <li><p>设置appear=｛true｝意思是第一次展示就会有动画效果，第一帧的class叫 .slide-appear  .slide-appear-active</p></li></ol> <h2 id="redux"><a href="#redux" class="header-anchor">#</a> redux:</h2> <ol><li>创建store需要使用createStore方法,并且传入reducer参数</li> <li>store里面有一个reducer.js文件，负责管理整个应用的数据</li> <li>store.dispatch调用方法</li></ol> <h5 id="combinereducers-功能-是redux中-redux-immutable中的功能"><a href="#combinereducers-功能-是redux中-redux-immutable中的功能" class="header-anchor">#</a> combineReducers 功能（是redux中/ redux-immutable中的功能）</h5> <p>combineReducers整合所有的reducer，避免一个reducer中有太多的数据引起混乱</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">header</span><span class="token operator">:</span> headerReducer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>可以在每个组件中创建一个store和reducer做模块化，最好也使用 <strong>actionCreator</strong> 统一创建action</p> <h3 id="redux-thunk中间件"><a href="#redux-thunk中间件" class="header-anchor">#</a> redux-thunk中间件</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>yarn add redux<span class="token operator">-</span>thunk
</code></pre></div><p>redux-thunk中间件帮助在 Redux 应用中实现异步性。是对dispatch的升级</p> <p>store中要使用middleware， 需要使用applyMiddleware(...middleware)</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> composeEnhancers <span class="token operator">=</span>
  <span class="token keyword">typeof</span> window <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION_COMPOSE__
    <span class="token operator">?</span> window<span class="token punctuation">.</span><span class="token function">__REDUX_DEVTOOLS_EXTENSION_COMPOSE__</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">:</span> compose
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token function">composeEnhancers</span><span class="token punctuation">(</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>在actioncreators中  直接返回一个<strong>方法(函数)</strong></p> <p><strong>actioncreators中不需要暴露的方法最好放在顶部或者底部集中放置</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getTodoList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">dispatch</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
       <span class="token string">&quot;https://www.easy-mock.com/mock/5f583bdbd5906660c22daac7/react/getList&quot;</span>
     <span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;获取axios的list&quot;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
       <span class="token keyword">let</span> action <span class="token operator">=</span> <span class="token function">initListAction</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>list<span class="token punctuation">)</span>
       <span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
</code></pre></div><h3 id="react-redux"><a href="#react-redux" class="header-anchor">#</a> react-redux</h3> <ol><li><p>react-redux的核心组件<strong>Provider</strong></p> <p>组件使用<strong>Provider</strong>包裹 ，可以绑定state={state}</p> <p>这样包裹的组件都可以使用store里的数据了</p></li> <li><p><strong>connect</strong> 方法是连接方法，让组件和store做连接，前提是该组件被Provider包裹</p></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>TodoList<span class="token punctuation">[</span>自己的组件名<span class="token punctuation">]</span><span class="token punctuation">)</span>   
</code></pre></div><p>​		有两个：</p> <p>​		<strong>mapStateToProps</strong>   把state映射到props</p> <p>​		<strong>mapDispatchToProps</strong> 和dispatch做关联</p> <h3 id="immutable对象"><a href="#immutable对象" class="header-anchor">#</a> immutable对象</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>yarn add immutable
</code></pre></div><p>immutable对象不可以被改变，用来固定一个变量，避免被改</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> fromJS <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;immutable&quot;</span>
<span class="token keyword">const</span> defaultState <span class="token operator">=</span> <span class="token function">fromJS</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">focused</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>获取值要使用 <strong>get('变量名').get('变量名')</strong>  或者使用使用 <strong>getIn(['a','b','c'])</strong></p> <p>改变值要使用 <strong>state.set('focused',true)</strong></p> <p>改变多个值可以使用 <strong>state.merge({list:action.data,totalPage: action.totalPage})</strong></p> <p>immutable对象的set方法，会结合之前的immutable对象的值和设置的值，返回一个全新的对象（并不是直接使用平常的state.set方法的意思 ）</p> <p>fromJS是把数据改成immutable对象，toJS是把immutable对象转换成普通数据类型，也可以使用List()方法转化成immutable对象，需要注意的是List()方法只能把外层转化成immutable对象，层级深的不能转化</p> <h3 id="redux-immutable插件"><a href="#redux-immutable插件" class="header-anchor">#</a> redux-immutable插件</h3> <p>引入redux-immutable中的combineReducers，这样创建的对象就是一个immutable对象，获取里面的值需要使用get，set方法</p> <h3 id="react-router-dom路由"><a href="#react-router-dom路由" class="header-anchor">#</a> react-router-dom路由</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>yarn add react<span class="token operator">-</span>router<span class="token operator">-</span>dom
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserRouter<span class="token punctuation">,</span> Route <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router-dom&quot;</span>
</code></pre></div><p>BrowserRouter, Route(路由规则)都是只能在有一个外层盒子</p> <p>HashRouter和BrowserRouter两个路由格式,  一个带#号一个不带</p> <p>可以加上exact  路径全相等才显示，不加则是只要包含该字符串就显示</p> <p>如果使用了嵌套路由, 使用exact的话容易出现子路由出不来的情况, 因为精准匹配在父路由就被拦截了</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Link <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-router-dom&quot;</span>
</code></pre></div><p>使用Link替代a标签，跳转使用to  可以写字符串或者对象</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>to<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">pathname</span><span class="token operator">:</span><span class="token string">'/home/7'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre></div><p>withRouter可以有能力获取router页面的内容</p> <p>withRouter(组件名)</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;Router path=&quot;/&quot; component={Main}&gt;&lt;/Router&gt;
</code></pre></div><p>component一定要是小写</p> <Router></Router>只写component不写path的话 可以放最后用于匹配其他路由显示404页面
<p>使用 <Switch></Switch> 标签包裹,里面写每个Route, 项目会根据path路径匹配展示对应的路由</p> <h3 id="purecomponent是另一种component"><a href="#purecomponent是另一种component" class="header-anchor">#</a> PureComponent是另一种Component</h3> <p>PureComponent自带了shouldComponentUpdate浅比较功能，用来提升性能</p> <p>使用PureComponent最好是结合immutable数据格式，不然会遇到坑</p> <p>在render函数中可以使用 <strong>this.props.match.params</strong> 拿到路由携带过来的参数 / 后面的参数</p> <p>在render函数中可以使用 <strong>this.props.match.location</strong> 拿到路由携带过来的参数 ？后面的参数（需要自己解析）</p> <p>使用innerRef可以获取到真实的dom元素</p> <p>在render里面写上{this.props.children} 表示自定义子页面</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Redirect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span>
</code></pre></div><p>Redirect用来重定向页面</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>Redirect to<span class="token operator">=</span><span class="token string">&quot;/login&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><h3 id="react-loadable"><a href="#react-loadable" class="header-anchor">#</a> react-loadable</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>yarn add react<span class="token operator">-</span>loadable
</code></pre></div><h6 id="example"><a href="#example" class="header-anchor">#</a> Example</h6> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Loadable <span class="token keyword">from</span> <span class="token string">'react-loadable'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Loading <span class="token keyword">from</span> <span class="token string">'./my-loading-component'</span><span class="token punctuation">;</span>  <span class="token comment">//这个就是加载页面的组件，可删掉或自己写</span>
 
<span class="token keyword">const</span> LoadableComponent <span class="token operator">=</span> <span class="token function">Loadable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">loader</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">loading</span><span class="token operator">:</span> Loading<span class="token punctuation">,</span> <span class="token comment">//loading是一个函数，返回一个对象或者组件</span>
  <span class="token function-variable function">loading</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">//下面的可以替代上面的内容</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>正在加载<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>LoadableComponent<span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用less"><a href="#使用less" class="header-anchor">#</a> <strong>使用Less</strong></h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>yarn add less less<span class="token operator">-</span>loader
</code></pre></div><p>先使用yarn eject暴露项目</p> <p>然后在文件webpack.config.js中大概在60多行增加代码</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> lessRegex <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>    <span class="token comment">//新增</span>
<span class="token keyword">const</span> lessModuleRegex <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.module\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>    <span class="token comment">//新增</span>
</code></pre></div><p>在sass配置的后面增加:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> lessRegex<span class="token punctuation">,</span>
    <span class="token literal-property property">exclude</span><span class="token operator">:</span> lessModuleRegex<span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token function">getStyleLoaders</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">importLoaders</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token literal-property property">sourceMap</span><span class="token operator">:</span> isEnvProduction <span class="token operator">&amp;&amp;</span> shouldUseSourceMap<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;less-loader&quot;</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sideEffects</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> lessModuleRegex<span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token function">getStyleLoaders</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span>
            <span class="token literal-property property">importLoaders</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token literal-property property">sourceMap</span><span class="token operator">:</span> isEnvProduction <span class="token operator">&amp;&amp;</span> shouldUseSourceMap<span class="token punctuation">,</span>
            <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">getLocalIdent</span><span class="token operator">:</span> getCSSModuleLocalIdent<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;less-loader&quot;</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="跨域代理"><a href="#跨域代理" class="header-anchor">#</a> 跨域代理</h3> <p>安装 http-proxy-middleware (1.0+版本要使用createProxyMiddleware, 不使用proxy了)</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>yarn add http<span class="token operator">-</span>proxy<span class="token operator">-</span>middleware
</code></pre></div><p>在src文件夹下新建 setupProxy.js文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> createProxyMiddleware <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http-proxy-middleware&quot;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// app.use(</span>
  <span class="token comment">//   createProxyMiddleware(&quot;/weather&quot;, { target: &quot;http://api.map.baidu.com/&quot; })</span>
  <span class="token comment">// )</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
    <span class="token function">createProxyMiddleware</span><span class="token punctuation">(</span><span class="token string">&quot;/weather&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;http://api.map.baidu.com/&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token comment">// pathRewrite: {</span>
      <span class="token comment">//   &quot;^/api&quot;: &quot;/&quot;,</span>
      <span class="token comment">// },</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="createref"><a href="#createref" class="header-anchor">#</a> <strong>createRef()</strong></h3> <p>通过formRef = React.createRef()创建ref实例, 然后通过ref={this.formRef}绑定实例</p> <p>在需要获取值的地方const form = this.formRef.current  获取到form实例</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function-variable function">getValues</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> form <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>formRef<span class="token punctuation">.</span>current
    <span class="token keyword">const</span> values <span class="token operator">=</span> form<span class="token punctuation">.</span><span class="token function">getFieldsValue</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;values&quot;</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>获取this.formRef.current一定要写成箭头函数, 不然获取不到this</p> <p><strong>这是class类组件的方法, 如果是用的函数方法好像是要用useImperativeHandle</strong></p> <p>函数组件不像类组件有实例，所以不能通过 createRef 实现对子组件的引用，而是在子组件内通过 forwardRef + useImperativeHandle 的方式向父组件暴露数据</p> <p>forwardRef和useImperativeHandle 都是react中的方法,需要先引用</p> <div class="language- extra-class"><pre class="language-text"><code>const Child2 = forwardRef((props, ref) =&gt; {
  const [ msg, setMsg ] = useState('我是 child')
  useImperativeHandle(ref, () =&gt; ({
    // 向外暴露修改 msg 的方法
    fn: () =&gt; {
      setMsg(msg =&gt; msg + '!')
    }，
    msg
  }))
  return (
    &lt;div&gt;
      &lt;p&gt;{ msg }&lt;/p&gt;
    &lt;/div&gt;
  )
})
</code></pre></div><h3 id="获取子组件的数据或方法"><a href="#获取子组件的数据或方法" class="header-anchor">#</a> 获取子组件的数据或方法</h3> <p>首先在父组件页面给子组件绑定onRef</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>Child onRef<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">（ref）</span><span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>child<span class="token operator">=</span>ref<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>   <span class="token comment">//child随便取名</span>
</code></pre></div><p>然后在子组件的componentDidMount中写上 <strong>this.props.onRef(this)</strong></p> <p>然后在父组件里就可以使用了</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>child<span class="token punctuation">.</span>state<span class="token punctuation">.</span>xxx <span class="token comment">//获取</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>child<span class="token punctuation">.</span><span class="token function">dosomthing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 调用</span>
</code></pre></div><h3 id="react引用百度地图map"><a href="#react引用百度地图map" class="header-anchor">#</a> react引用百度地图Map</h3> <p>先获取通过ID盒子获取一个地图实例, 然后设置中心点</p> <p><strong>BMapGL如果报错的话 前面需要加上window实例</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>BMapGL<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token string">&quot;orderDetailMap&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">centerAndZoom</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>BMapGL<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token number">116.404</span><span class="token punctuation">,</span> <span class="token number">39.915</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>每一个坐标点都需要转化成Point点才能使用</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>BMapGL<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token number">116.404</span><span class="token punctuation">,</span> <span class="token number">39.915</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="引入echarts"><a href="#引入echarts" class="header-anchor">#</a> 引入echarts</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm install <span class="token operator">--</span>save echarts<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">-</span>react
npm install <span class="token operator">--</span>save echarts
</code></pre></div><p>设置主题</p> <p>先引入echartTheme然后</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	echarts<span class="token punctuation">.</span><span class="token function">registerTheme</span><span class="token punctuation">(</span><span class="token string">&quot;Imooc&quot;</span><span class="token punctuation">,</span> echartTheme<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>获取数据以后然后渲染数据</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>ReactEchart option<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getOption</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>  theme<span class="token operator">=</span><span class="token string">&quot;Imooc&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre></div><p>页面可能会报错Attempted import error: ‘echarts‘ does not contain a default export (imported as ‘echarts‘)</p> <p>方法一：很大可能是echarts-for-react不支持echarts最新版本，可以安装旧版本
指令：npm install echarts@4.9.0</p> <p>方法二：把import方式 改成：var echarts = require(‘echarts’);
如果要用import，就这样：import * as echarts from ‘echarts’</p> <p>如果需要按需加载的话:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token string">&quot;echarts/lib/chart/bar&quot;</span>
<span class="token keyword">import</span> <span class="token string">&quot;echarts/lib/component/tooltip&quot;</span>
<span class="token keyword">import</span> <span class="token string">&quot;echarts/lib/component/title&quot;</span>
<span class="token keyword">import</span> <span class="token string">&quot;echarts/lib/component/legend&quot;</span>
<span class="token keyword">import</span> <span class="token string">&quot;echarts/lib/component/markPoint&quot;</span>
</code></pre></div><h3 id="react-hooks"><a href="#react-hooks" class="header-anchor">#</a> React Hooks</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">[</span> count <span class="token punctuation">,</span> setCount <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用的es6的解构,  分别是声明、读取、使用（修改）</p> <p>等同于下面的代码</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> _useState <span class="token operator">=</span> <span class="token function">userState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> count <span class="token operator">=</span> _useState<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> setCount <span class="token operator">=</span> _useState<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
</code></pre></div><p><strong>React Hooks不能出现在条件判断语句中，因为它必须有完全一样的渲染顺序</strong>。</p> <h4 id="useeffect"><a href="#useeffect" class="header-anchor">#</a> useEffect</h4> <p><strong>useEffect</strong>的第二个参数, 它是一个数组，数组中可以写入很多状态对应的变量，意思是当状态值发生变化时，我们才进行解绑。但是当传空数组<code>[]</code>时，就是当组件将被销毁时才进行解绑，这也就实现了<code>componentWillUnmount</code>的生命周期函数。</p> <h4 id="usecontext-父子组件的传值"><a href="#usecontext-父子组件的传值" class="header-anchor">#</a> useContext   父子组件的传值</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> CountContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>CountContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>CountContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
</code></pre></div><p>里面包裹子组件, 子组件通过useContext 获取值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> CountContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>CountContext<span class="token punctuation">)</span>  <span class="token comment">//一句话就可以得到count</span>
</code></pre></div><p>const CountContext = createContext()最好是写在公共部分, 不然两个组件都需要创建</p> <h3 id="usereducer"><a href="#usereducer" class="header-anchor">#</a> useReducer</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useReducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">ReducerDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span> count <span class="token punctuation">,</span> dispatch <span class="token punctuation">]</span> <span class="token operator">=</span><span class="token function">useReducer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span>action</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">'add'</span><span class="token operator">:</span>
                <span class="token keyword">return</span> state<span class="token operator">+</span><span class="token number">1</span>
            <span class="token keyword">case</span> <span class="token string">'sub'</span><span class="token operator">:</span>
                <span class="token keyword">return</span> state<span class="token operator">-</span><span class="token number">1</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">return</span> state
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
       <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
           <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>现在的分数是<span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
           <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Increment<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
           <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'sub'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Decrement<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
       <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> ReducerDemo
</code></pre></div><p><strong>useReducer所在的function需要大写开头</strong>, 不然使用会报错</p> <p>useReducer要传入两个参数,一个是Reducer一个是初始值</p> <p>接受useReducer也有两个值, 一个是当前变量, 一个是dispatch方法</p> <h3 id="usememo"><a href="#usememo" class="header-anchor">#</a> useMemo</h3> <p>解决子组件重复渲染的问题, 用法和useEffect一样有两个参数</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/webBlog/blog/Nuxt/" class="prev">
        安装
      </a></span> <span class="next"><a href="/webBlog/blog/ts/">
        : number   : string   是类型注解
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/webBlog/assets/js/app.e7dfd760.js" defer></script><script src="/webBlog/assets/js/2.733019b2.js" defer></script><script src="/webBlog/assets/js/12.feaed3b6.js" defer></script>
  </body>
</html>
